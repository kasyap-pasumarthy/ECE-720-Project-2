CXXFLAGS=-MMD -MP -Wall -DSC_INCLUDE_DYNAMIC_PROCESSES -Wno-unused -std=c++11 -DPREFIX=\"/afs/eos.ncsu.edu/lockers/research/ece/wdavis/tools/riscv/2020.05/riscv\"
EXE_NAME=main.x

all: rel

rel: OPTFLAGS = -O3

rel: $(EXE_NAME)

dbg: OPTFLAGS = -O0 -g

dbg: $(EXE_NAME)

.PHONY: dbg rel


CXXFLAGS+=$(OPTFLAGS)


SRC = $(wildcard *.cpp)
OBJ = $(addsuffix .o, $(basename $(SRC)))
INCLUDES= -I/afs/eos.ncsu.edu/lockers/research/ece/wdavis/tools/riscv/2020.05/systemc-2.3.3/include
LIBS= -L/afs/eos.ncsu.edu/lockers/research/ece/wdavis/tools/riscv/2020.05/systemc-2.3.3/lib-linux64 \
      -lsystemc -lm -pthread -Wl,-rpath \
      -Wl,/afs/eos.ncsu.edu/lockers/research/ece/wdavis/tools/riscv/2020.05/systemc-2.3.3/lib-linux64 \
      -lspike

REBUILDABLES=$(OBJ) $(EXE_NAME)

#   $@ target name, $^ target deps, $< matched pattern
$(EXE_NAME): $(OBJ)
	$(CXX) $(CXXFLAGS) $(LIBS) -o $@ $^ 
	@echo "Built $@ successfully" 

#include the autogenerated dependency files for each .o file
-include $(OBJ:.o=.d)

# build dependency list via gcc -M and save to a .d file
%.d : %.cpp
	@$(CXX) -M $(CXXFLAGS) $(INCLUDES) $< 

# build all .cpp files to .o files
%.o : %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $@ -c $<

clean: 
	-rm -f $(REBUILDABLES) *.d

sim:
	./$(EXE_NAME)

gdb:
	gdb ./$(EXE_NAME)
